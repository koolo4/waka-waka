# 🎌 Интеграция с Внешними API - Быстрый Старт (РУС)

## ✨ Что нового?

Теперь вы можете импортировать аниме напрямую из:
- **MyAnimeList** (Jikan API)
- **AniList** (GraphQL API)

Получите:
- 🖼️ Высокачественные изображения обложек
- 📝 Подробные описания и синопсисы
- 🏷️ Теги жанров, студии, годы выпуска
- ⭐ Рейтинги и показатели популярности
- 🎬 Рекомендации похожих аниме

---

## 🚀 Как Использовать

### Шаг 1: Перейти в Админ-Панель
```
Главная страница
    ↓
Клик на аватар (верхний правый угол)
    ↓
Выбрать "Admin Panel"
    ↓
URL: http://localhost:3000/admin
```

### Шаг 2: Нажать "Import Anime"
```
Верхняя часть админ-панели
    ↓
Кнопка [⬇ Import Anime]  (рядом с кнопкой "Назад")
    ↓
Откроется страница импорта
```

### Шаг 3: Выбрать Источник
```
┌─────────────────────────────────────┐
│ [MyAnimeList]    [AniList]          │  <- Выбрать один
│                                      │
│ или кликнуть на вкладку             │
└─────────────────────────────────────┘
```

### Шаг 4: Два Способа Импорта

**Способ A: Ручной Поиск**
```
1. Ввести название аниме в поле поиска
   [Введите "Атака титанов"]
   
2. Нажать кнопку [🔍 Search]
   
3. Подождать результаты (~1-2 секунды)
   
4. Увидеть результаты с изображениями
   
5. Нажать [Import] на нужном аниме
```

**Способ B: Синхронизация Популярных**
```
1. Нажать кнопку [⭐ Sync Popular]
   
2. Подтвердить синхронизацию
   
3. Система автоматически:
   - Загружает ТОП-20 аниме
   - Проверяет на дубликаты
   - Импортирует отсутствующие
   
4. Видеть результат:
   ✓ Импортировано: 15 новых аниме
   ⊘ Пропущено: 5 (уже есть)
```

---

## 📊 Что Импортируется

При импорте сохраняется:
- ✅ Название аниме
- ✅ Описание/Синопсис
- ✅ Жанры
- ✅ Год выпуска
- ✅ Студия
- ✅ Обложка (изображение высокого качества)
- ✅ Внешний ID (MAL/AniList)
- ✅ Рейтинг из источника
- ✅ Популярность
- ✅ Время последней синхронизации

---

## 🔄 Как Это Работает

```
Поиск пользователя
    ↓
Запрос к API
    ↓
Результаты с изображениями
    ↓
Нажимаем Import
    ↓
Система проверяет:
├─ Уже существует? → Обновляет
└─ Новое? → Создает
    ↓
Сохраняет в БД
    ↓
Готово! ✅
```

---

## 🎯 Примеры Использования

### Пример 1: Начальное Заполнение Каталога
```
1. Идете в Admin → Import Anime
2. Кликаете "Sync Popular" для MyAnimeList
3. Система импортирует ТОП-20 популярных
4. Повторяете для AniList
5. Получаете ~40 лучших аниме в каталоге
```

### Пример 2: Поиск Конкретного Аниме
```
1. Пользователь ищет "Евангелион"
2. Не находит в вашей БД
3. Вы идете в Admin → Import Anime
4. Ищете "Evangelion" на MyAnimeList
5. Находите и импортируете
6. Пользователь видит в каталоге
```

### Пример 3: Обновление Данных
```
1. Существующее аниме без хорошей обложки
2. Идете в Admin → Import Anime
3. Ищете это аниме
4. Кликаете Import
5. Система обновляет изображение и описание
```

---

## 🗄️ Что Добавлено в БД

Новые поля в таблице `Anime`:
- `malId` - ID на MyAnimeList
- `anilistId` - ID на AniList
- `externalSource` - какой источник использован
- `externalRating` - рейтинг из источника
- `externalPopularity` - популярность
- `lastSyncedAt` - когда последний раз синхронизировано

---

## ⚡ Особенности

### ✓ Умная Дедупликация
- Система проверяет по названию
- Не создает дубликаты
- Обновляет существующие данные

### ✓ Обработка Ошибок
- Автоматические повторы при ошибке
- Экспоненциальная задержка (1s, 2s, 4s)
- Уважает ограничения API

### ✓ Безопасность
- Требует админские права
- Проверка авторизации
- Валидация данных

### ✓ Производительность
- Пакетные операции
- Ограничение между запросами
- Быстрый импорт

---

## 📈 Сравнение Источников

```
┌──────────────────────┬──────────────────┬──────────────────┐
│ Параметр             │ MyAnimeList      │ AniList          │
├──────────────────────┼──────────────────┼──────────────────┤
│ Размер БД            │ 🔵 Огромная      │ 🟣 Большая       │
│ Качество изображений │ ✓ Высокое        │ ✓ Высокое        │
│ Описания             │ ✓ Подробные      │ ✓ Подробные      │
│ Скорость API         │ ⚡ Быстро        │ ⚡ Очень быстро   │
│ Ограничение 1/мин    │ 60 запросов      │ 90 запросов      │
│ Рекомендации         │ ❌ Нет           │ ✓ Есть           │
│ Обновления           │ 📅 Ежедневно     │ ⏱️ В реальном    │
└──────────────────────┴──────────────────┴──────────────────┘
```

---

## 🛠️ API Эндпоинты

### Поиск Аниме
```bash
GET /api/external-sync?action=search&source=mal&query=naruto
```

### Импорт Аниме
```bash
POST /api/external-sync?action=import&animeId=20&source=mal
```

### Синхронизация Популярных
```bash
GET /api/external-sync?action=sync-popular&source=anilist&limit=20
```

---

## ❓ Часто Задаваемые Вопросы

**Q: Аниме не найдено?**  
A: Попробуйте частичное названием или проверьте на исходном сайте

**Q: Получаю ошибку "Rate Limited"?**  
A: Система автоматически повторит. Подождите 60+ секунд перед новой попыткой

**Q: Создаются дубликаты?**  
A: Система проверяет по названию. Если все еще дубликаты - проверьте альтернативные названия

**Q: Не импортируются изображения?**  
A: Проверьте источник, может быть ограничение CDN. Попробуйте другой источник

**Q: Как планировать автоматическую синхронизацию?**  
A: Используйте API напрямую через cron-задачи (будет в будущей версии)

---

## 📚 Документация

- **EXTERNAL_API_QUICKSTART.md** - Быстрый старт (англ.)
- **EXTERNAL_API_GUIDE.md** - Полное руководство (англ.)
- **EXTERNAL_API_VISUAL_GUIDE.md** - Визуальное руководство (англ.)
- **EXTERNAL_API_IMPLEMENTATION.md** - Технические детали (англ.)

---

## ✅ Что Было Добавлено

✓ Интеграция MyAnimeList  
✓ Интеграция AniList  
✓ API эндпоинты  
✓ Админ интерфейс  
✓ Компонент поиска  
✓ Страница импорта  
✓ Синхронизация БД  
✓ Обработка ошибок  
✓ Документация  

---

## 🎬 Визуальное Руководство

Для визуального руководства с примерами интерфейса см. **EXTERNAL_API_VISUAL_GUIDE.md**

---

## 🔗 Полезные Ссылки

- MyAnimeList: https://myanimelist.net
- AniList: https://anilist.co
- Jikan API: https://docs.api.jikan.moe
- AniList GraphQL: https://anilist.gitbook.io/anilist-graphql-api

---

**Статус**: ✅ Готово к Использованию  
**Дата**: 17 января 2026  
**Версия**: 1.0 - Полная
